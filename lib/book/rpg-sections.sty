\RequirePackage[titles]{tocloft}
\RequirePackage[newparttoc]{titlesec}	% Used to adjust (sub)section formatting
\RequirePackage{amssymb}
\RequirePackage{everypage}

\iftoggle{multitoc}{%
  \RequirePackage[toc]{multitoc}
}{}

% cover
\newkeycommand\rpgMakeCover[
    image=,
    %logo=,
    title=Title,
    subtitle=subtitle,
    ]{
    \onecolumn
    \thispagestyle{empty}
    \AddThispageHook{
        \tikz[remember picture,overlay] \node[inner sep=0pt] at (current page.center){\includegraphics[width=1.0286\paperwidth,height=1.0202\paperheight]{\commandkey{image}}};
    }
    \begin{center}
        %\vspace*{15mm}\includegraphics[width=15cm]{\commandkey{logo}}\\*
        \vspace*{10mm}
        \nodesto%
        \fontsize{36pt}{36pt}
        \selectfont
        \fillstroke{[1]}{[0]}{0.5}{\color{subtitle}\MakeUppercase{\commandkey{title}}}\\*
        %\normalfont\normalsize\includegraphics[width=.5\paperwidth]{lib/book/img/separator}
        \LARGE\vfill
        \fontsize{24pt}{24pt}
        \fillstroke{[1]}{[0]}{0.5}{\textbf{\commandkey{subtitle}}}
    \end{center}
    \clearpage
    \twocolumn%
}

\newkeycommand\rpgChapterImage[
image=,
]{
	\begin{tikzpicture}[remember picture,overlay]
		\node [shift={(10.5cm,-5.7cm)}]  at (current page.north west) {\includegraphics[width=1.0286\paperwidth]{\commandkey{image}}};
	\end{tikzpicture}
}


\newkeycommand\rpgCharakterImage[
image=,
]{
	\begin{tikzpicture}[remember picture,overlay]		
		\checkoddpage
		\ifoddpage
			\node [inner sep=0pt]  at (13cm, -12.9cm) {\includegraphics[width=9cm, height=30.3cm]{\commandkey{image}}};
	
		\else
			\node [inner sep=0pt]  at (4.2cm, -12.9cm) {\includegraphics[width=9cm, height=30.3cm]{\commandkey{image}}};
		\fi
	\end{tikzpicture}
	\charnewcol
}

\newkeycommand\rpgMakeMap[
image=,
%logo=,
%title=Title,
%subtitle=subtitle,
]{
	\onecolumn
	\thispagestyle{empty}
	\AddThispageHook{
		\tikz[remember picture,overlay] \node[inner sep=0pt] at (current page.center){\includegraphics[width=1.0286\paperwidth,height=1.0202\paperheight]{\commandkey{image}}};
	}
	\begin{center}

	\end{center}
	\clearpage
	\twocolumn%
}

\newkeycommand\rpgMakeChar[
image=,
%logo=,
%title=Title,
%subtitle=subtitle,
]{
	\onecolumn
	\thispagestyle{empty}
	\AddThispageHook{
		\tikz[remember picture,overlay] \node[inner sep=0pt] at (current page.center){\includegraphics[width=1.0286\paperwidth,height=1.0202\paperheight]{\commandkey{image}}};
	}
	\begin{center}
		
	\end{center}
	\clearpage
	\twocolumn%
}

%%%%%%%%%%%%%% \part

\titleformat{\part}
[display]
{\thispagestyle{part}\nodesto\fontsize{50pt}{50pt}\selectfont\color{title1}\filcenter}
{\partname \thepart}
{-15pt}
{\Large}%

\titlespacing*{\part}{0pt}{-54pt}{0pt}

%%%%%%%%%%%%%% \chapter

% Normal Table of Contents
\titleformat{name=\chapter, numberless}
{\thispagestyle{chapter}\vspace{0pt}\color{title1}\rpg@ChapterFont}
{}
{0pt}
{\Huge}

\titleformat{\chapter}
[display]
{\thispagestyle{chapter}\vspace{170pt}\color{title1}\rpg@ChapterFont}
{\flushright \normalsize \color{title1} \MakeUppercase{\chaptertitlename}{\fontsize{60}{60}\selectfont \color{title1}\hspace{10pt}\thechapter}}
{0em}
{\Huge}
[{\titleline{\color{exboxbackground}\titlerule[2pt]}}]


\titleformat{\chapter}
[display]
{\thispagestyle{chapter}\vspace{50pt}\color{title1}\rpg@ChapterFont}
{\flushright \normalsize \color{title1} \MakeUppercase{\chaptertitlename}{\fontsize{60}{60}\selectfont \color{title1}\hspace{10pt}\thechapter}}
{0em}
{\Huge}
[{\titleline{\color{exboxbackground}\titlerule[2pt]}}]


\titleformat{\lands}
[display]
{\thispagestyle{chapter}\vspace{170pt}\color{title1}\rpg@ChapterFont}
{\flushright \normalsize \color{title1} \MakeUppercase{\chaptertitlename}{\fontsize{60}{60}\selectfont \color{title1}\hspace{10pt}\thechapter}}
{0em}
{\Huge}
[{\titleline{\color{exboxbackground}\titlerule[2pt]}}]

%%%%%%%%%%%%%% \section

\titleformat{\section}%[block]
{\color{title1}\rpg@TitleFont\huge}{\thesection}{0.5em}{}
[{\titleline{\color{exboxbackground}\titlerule[0.5pt]}}]

%%%%%%%%%%%%%% \subsection

\titleformat{\subsection}%[block]
{\color{title2}\rpg@TitleFont\Large}{\thesubsection}{0.5em}{}%{$\bigstar$ }
[{\titleline{\color{exboxbackground}\titlerule[0.5pt]}}]

%%%%%%%%%%%%%% \subsubsection

\titleformat{\subsubsection}
{\color{title3}\rpg@TitleFont\Large}{\thesubsubsection}{0em}{}%{$\blacktriangleright$ }[]

%%%%%%%%%%%%%% \paragraph

\titleformat{\paragraph}
{\color{title3}\rpg@TitleFont\normalsize\large}{\theparagraph}{0em}{} 

%%%%%%%%%%%%%% \subparagraph

\titleformat{\subparagraph}[runin]
{\rpg@TitleFont\normalsize}%\bfseries\slshape}
{\thesubparagraph\quad}
{0pt}
{}
[:]

\titlespacing*{\subparagraph}{\parindent}{\parskip}{\wordsep}

%%%%%%%%%%%%%% \subtitle

% Special command for magic items, traps, and the like.
\newcommand{\subtitlesection}[2]{
    \subsubsection{#1}\vspace{-1ex}
    \textit{#2}\vspace{1ex}\par
}

